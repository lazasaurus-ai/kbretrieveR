% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/kb_chat.R
\name{kb_chat_with_ellmer}
\alias{kb_chat_with_ellmer}
\title{Ask ellmer with KB context injected}
\usage{
kb_chat_with_ellmer(
  kb_id,
  question,
  chat_client = NULL,
  region = NULL,
  number_of_results = 5,
  max_snippets = 5,
  snippet_chars = 1500,
  include_metadata = TRUE,
  append_sources = FALSE,
  return_raw = FALSE,
  verbose = TRUE
)
}
\arguments{
\item{kb_id}{Knowledge Base ID (character).}

\item{question}{Character: user prompt / question.}

\item{chat_client}{Either:
\itemize{
\item an ellmer client object with \verb{$chat()} method, or
\item a function that takes a single string prompt and returns a response.
If \code{NULL}, the function will try \code{getOption("kbretrieveR.chat_client")}.
}}

\item{region}{AWS region for KB retrieval (optional).}

\item{number_of_results}{Number of KB results to request (default 5).}

\item{max_snippets}{How many top KB snippets to include (default 5).}

\item{snippet_chars}{Truncate each snippet to this many characters (default 1500).}

\item{include_metadata}{Logical: include \code{source_uri} + \code{chunk_id} headings above each snippet.}

\item{append_sources}{Logical: when TRUE, append a "Sources" section to the reply (default FALSE).}

\item{return_raw}{Logical: if TRUE return a list with response, parsed_kb, raw_parsed, prompt, sources.}

\item{verbose}{Logical; print some info.}
}
\value{
By default the chat response (character). If \code{return_raw=TRUE} returns a list with
\code{response}, \code{parsed_kb}, \code{raw_parsed}, \code{prompt}, and \code{sources} (or NULL when not appended).
}
\description{
Retrieve context from a Bedrock KB and inject it into a prompt for an ellmer chat client.
}
\details{
The function will:
\enumerate{
\item call \code{kb_retrieve_httr(..., return_raw = TRUE)} to get snippets,
\item build a prompt of the form:
\link{User Provided This Prompt}\if{html}{\out{
<user question>
}}

\subsection{\link{KB retrieval - use the following context to answer the question if available}
SOURCE: <source_uri> (chunk: <chunk_id>)
\if{html}{\out{<snippet>}}}{
\item send that prompt to the provided \code{chat_client}.
}

Optionally, if \code{append_sources = TRUE}, append a "Sources" section listing the
URIs (and chunk ids) of the snippets included in the prompt.
}
}
